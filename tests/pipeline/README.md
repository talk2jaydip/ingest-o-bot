# Test Pipeline

This folder contains test scripts to verify the document indexing pipeline and check if embeddings are properly generated.

## Available Tests

### 1. Chunking Debug Test

**Script:** `test_chunking_debug.py`

**Purpose:** Debug and analyze document chunking behavior, including chunk boundaries, overlaps, and duplications.

**What it checks:**
- Document extraction from PDF
- Chunking logic and boundaries
- Chunk token counts and character lengths
- Overlap between consecutive chunks
- Content duplication detection

**Usage:**

```bash
# Run from the test_pipeline directory
python test_chunking_debug.py

# Or run from the project root
python test_pipeline/test_chunking_debug.py
```

**Prerequisites:**
- `.env` file configured with Document Intelligence credentials
- Test PDF file (default: `test_file/sample_pages_test.pdf`)
- Required Python packages installed

**Expected Output:**

The script will display:
1. Extraction progress
2. Chunk details for each page:
   - Chunk index and page number
   - Token count and character length
   - First and last 200 characters of chunk
3. Duplication analysis showing overlapping content between chunks

---

### 2. Embeddings Verification Test

**Script:** `test_embeddings_check.py`

**Purpose:** Retrieves documents from Azure AI Search index and verifies if embeddings are present.

**What it checks:**
- Connection to Azure AI Search
- Document retrieval from the index
- Presence of embeddings in indexed documents
- Embedding dimensions
- Summary statistics

**Usage:**

```bash
# Run from the test_pipeline directory
python test_embeddings_check.py

# Or run from the project root
python test_pipeline/test_embeddings_check.py
```

**Prerequisites:**
- `.env` file configured with Azure AI Search credentials
- Documents already indexed in the search index
- Required Python packages installed (see `requirements.txt` in project root)

**Expected Output:**

The script will display:
1. Configuration details
2. List of retrieved documents with embedding status
3. Summary showing:
   - Total documents checked
   - Documents with embeddings
   - Documents without embeddings
   - Embedding dimensions

**Sample Output:**

```
======================================================================
AZURE AI SEARCH - EMBEDDINGS VERIFICATION TEST
======================================================================

Loading configuration from .env...
✓ Configuration loaded successfully
  - Search Endpoint: https://your-search-service.search.windows.net
  - Index Name: your-index-name

Connecting to Azure AI Search...
✓ Connected to search index

Retrieving documents from index...
----------------------------------------------------------------------
✓ Retrieved 10 documents

======================================================================
EMBEDDINGS ANALYSIS
======================================================================

Document 1:
  ID: sample_pages_test.pdf-page1-chunk0
  Source: sample_pages_test.pdf
  Page: sample_pages_test.pdf#page=1
  Content: This is the document content...
  ✓ Embeddings: PRESENT (dimension: 1536)

...

======================================================================
SUMMARY
======================================================================
Total documents checked: 10
Documents with embeddings: 10
Documents without embeddings: 0
Embedding dimensions found: [1536]

✓ SUCCESS: All documents have embeddings generated!
```

## Configuration

The test scripts use the same configuration as the main pipeline, loaded from the `.env` file in the project root. Make sure the following variables are set:

- `MINI_SEARCH_ENDPOINT` or `AZURE_SEARCH_SERVICE`
- `MINI_SEARCH_INDEX_NAME` or `AZURE_SEARCH_INDEX`
- `MINI_SEARCH_API_KEY` or `AZURE_SEARCH_KEY`

## Troubleshooting

**No documents found:**
- Ensure you have run the main pipeline to index documents first
- Verify the index name in `.env` matches your Azure AI Search index

**Missing embeddings:**
- Check if `MINI_USE_INTEGRATED_VECTORIZATION=true` in `.env`
  - If true, embeddings are generated by Azure (not stored in documents)
- Verify Azure OpenAI embeddings configuration
- Check pipeline logs for embedding generation errors

**Connection errors:**
- Verify Azure AI Search endpoint and API key
- Check network connectivity to Azure services
