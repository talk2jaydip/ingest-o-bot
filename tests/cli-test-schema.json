{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CLI Test Results Schema",
  "description": "Schema for ingest-o-bot CLI comprehensive test results",
  "type": "object",
  "required": ["summary", "test_results", "environment"],
  "properties": {
    "summary": {
      "type": "object",
      "description": "Aggregate test execution summary",
      "required": ["total_tests", "passed", "failed", "pass_rate", "total_duration_seconds", "timestamp"],
      "properties": {
        "total_tests": {
          "type": "integer",
          "description": "Total number of tests executed",
          "minimum": 0
        },
        "passed": {
          "type": "integer",
          "description": "Number of tests that passed",
          "minimum": 0
        },
        "failed": {
          "type": "integer",
          "description": "Number of tests that failed",
          "minimum": 0
        },
        "pass_rate": {
          "type": "number",
          "description": "Percentage of tests that passed",
          "minimum": 0,
          "maximum": 100
        },
        "total_duration_seconds": {
          "type": "number",
          "description": "Total execution time in seconds",
          "minimum": 0
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of test execution"
        }
      }
    },
    "test_results": {
      "type": "array",
      "description": "Individual test execution results",
      "items": {
        "type": "object",
        "required": ["test_id", "category", "description", "command", "exit_code", "expected_exit", "status", "duration_seconds", "timestamp"],
        "properties": {
          "test_id": {
            "type": "string",
            "description": "Unique test identifier (e.g., V01, I01)",
            "pattern": "^[A-Z]+[0-9]+$"
          },
          "category": {
            "type": "string",
            "description": "Test category",
            "enum": ["validation", "index_management", "input_sources", "document_actions", "artifact_management", "environment_files", "logging", "error_handling", "complex_combinations"]
          },
          "description": {
            "type": "string",
            "description": "Human-readable test description"
          },
          "command": {
            "type": "string",
            "description": "Full command executed"
          },
          "exit_code": {
            "type": "integer",
            "description": "Process exit code"
          },
          "expected_exit": {
            "oneOf": [
              {
                "type": "integer",
                "description": "Expected exit code"
              },
              {
                "type": "array",
                "description": "Multiple acceptable exit codes",
                "items": {
                  "type": "integer"
                }
              }
            ]
          },
          "status": {
            "type": "string",
            "description": "Test result status",
            "enum": ["PASS", "FAIL", "ERROR", "TIMEOUT", "SKIPPED"]
          },
          "duration_seconds": {
            "type": "number",
            "description": "Test execution time in seconds",
            "minimum": 0
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp of test start"
          },
          "stdout_lines": {
            "type": "integer",
            "description": "Number of lines in stdout",
            "minimum": 0
          },
          "stderr_lines": {
            "type": "integer",
            "description": "Number of lines in stderr",
            "minimum": 0
          },
          "stdout_preview": {
            "type": "string",
            "description": "First 500 characters of stdout"
          },
          "stderr_preview": {
            "type": "string",
            "description": "First 500 characters of stderr"
          }
        }
      }
    },
    "environment": {
      "type": "object",
      "description": "Test environment configuration",
      "required": ["project_root"],
      "properties": {
        "env_file": {
          "type": ["string", "null"],
          "description": "Environment file used for testing"
        },
        "skip_destructive": {
          "type": "boolean",
          "description": "Whether destructive tests were skipped"
        },
        "project_root": {
          "type": "string",
          "description": "Project root directory path"
        },
        "python_version": {
          "type": "string",
          "description": "Python version used for testing"
        },
        "platform": {
          "type": "string",
          "description": "Operating system platform"
        }
      }
    }
  }
}
