# ==========================================
# PRODUCTION DEPLOYMENT - ENVIRONMENT CONFIGURATION
# ==========================================
# Companion .env file for: 05_production_deployment.py
#
# This configuration demonstrates enterprise-grade production deployment
# with Azure services for reliability, scalability, and performance.
#
# ⚠️  WARNING: This is a PRODUCTION configuration
# ⚠️  Review and test thoroughly before deploying
#
# DEPLOYMENT CHECKLIST:
# ☐ 1. All Azure resources created and accessible
# ☐ 2. Service principals configured with least-privilege access
# ☐ 3. Secrets stored in Azure Key Vault (not in this file)
# ☐ 4. Monitoring and alerting configured
# ☐ 5. Backup and disaster recovery plan in place
# ☐ 6. Rate limits and quotas reviewed
# ☐ 7. Cost budgets and alerts configured
# ☐ 8. Security review completed
# ==========================================

# ==========================================
# VECTOR STORE: Azure AI Search
# ==========================================
VECTOR_STORE_MODE=azure_search

# Azure Search Configuration
AZURE_SEARCH_SERVICE=your-production-search-service
AZURE_SEARCH_INDEX=production-documents
AZURE_SEARCH_KEY=your-production-search-admin-key

# Or use endpoint directly:
# AZURE_SEARCH_ENDPOINT=https://your-production-search-service.search.windows.net

# Search Configuration
# Ensure index is created before running (use --setup-index)

# ==========================================
# EMBEDDINGS: Azure OpenAI
# ==========================================
EMBEDDINGS_MODE=azure_openai

# Azure OpenAI Configuration
AZURE_OPENAI_ENDPOINT=https://your-production-openai.openai.azure.com/
AZURE_OPENAI_KEY=your-production-openai-key
AZURE_OPENAI_API_VERSION=2024-12-01-preview

# Embedding Model
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-ada-002
# For newer models:
# AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-large
# AZURE_OPENAI_EMBEDDING_DIMENSIONS=1536

# Chat Model (for media descriptions if enabled)
AZURE_OPENAI_CHAT_DEPLOYMENT=gpt-4o-mini

# API Configuration
AZURE_OPENAI_MAX_RETRIES=5
AZURE_OPENAI_TIMEOUT=60
AZURE_OPENAI_MAX_CONCURRENCY=15

# Enable integrated vectorization (Azure-specific optimization)
AZURE_USE_INTEGRATED_VECTORIZATION=true

# ==========================================
# DOCUMENT PROCESSING: Azure Document Intelligence
# ==========================================

# Azure Document Intelligence (for PDF/Office extraction)
AZURE_DOC_INT_ENDPOINT=https://your-production-docint.cognitiveservices.azure.com/
AZURE_DOC_INT_KEY=your-production-document-intelligence-key

# Concurrency
AZURE_DI_MAX_CONCURRENCY=10

# ==========================================
# AZURE STORAGE: Blob Storage
# ==========================================

# Storage Account
AZURE_STORAGE_ACCOUNT=yourproductionstorage
AZURE_STORAGE_ACCOUNT_KEY=your-production-storage-key

# Or use connection string:
# AZURE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=yourproductionstorage;AccountKey=your-key;EndpointSuffix=core.windows.net

# Containers
AZURE_STORAGE_CONTAINER=production-documents-input
AZURE_ARTIFACTS_CONTAINER=production-artifacts

# ==========================================
# AZURE SERVICE PRINCIPAL (Recommended for Production)
# ==========================================
# Use service principal instead of keys for better security
# Create in Azure Portal → Azure AD → App Registrations

# AZURE_TENANT_ID=your-tenant-id
# AZURE_CLIENT_ID=your-client-id
# AZURE_CLIENT_SECRET=your-client-secret

# ==========================================
# AZURE KEY VAULT (Recommended for Production)
# ==========================================
# Store secrets in Key Vault instead of .env file
# KEY_VAULT_URI=https://your-production-keyvault.vault.azure.net/

# ==========================================
# INPUT CONFIGURATION: Blob Storage (Production)
# ==========================================

# Input Mode: Blob Storage
# PRODUCTION BEST PRACTICE: Use blob storage for scalability
INPUT_MODE=blob

# Blob Input Configuration
AZURE_BLOB_CONTAINER_IN=production-documents-input

# Optional: Process specific prefix only
# AZURE_BLOB_PREFIX=documents/2024/

# Optional: File filter pattern
# AZURE_BLOB_FILTER=*.pdf

# ==========================================
# OUTPUT CONFIGURATION: Blob Storage (Production)
# ==========================================

# Artifacts Mode: Blob Storage
# PRODUCTION BEST PRACTICE: Use blob storage for artifacts
ARTIFACTS_MODE=blob

# Blob Artifacts Configuration
AZURE_ARTIFACTS_CONTAINER=production-artifacts

# Store artifacts to blob
AZURE_STORE_ARTIFACTS_TO_BLOB=true

# Artifacts prefix (optional, for organization)
# AZURE_BLOB_CONTAINER_PREFIX=artifacts/processed/

# ==========================================
# DOCUMENT PROCESSING CONFIGURATION
# ==========================================

# Office Document Extraction
# Options: azure_di, markitdown, hybrid
# PRODUCTION RECOMMENDATION: hybrid (best reliability)
AZURE_OFFICE_EXTRACTOR_MODE=hybrid

# Hybrid fallback (use MarkItDown if Azure DI fails)
AZURE_OFFICE_OFFLINE_FALLBACK=true

# LibreOffice path (for hybrid/markitdown mode)
# Linux: /usr/bin/soffice
# Mac: /Applications/LibreOffice.app/Contents/MacOS/soffice
# Windows: C:\Program Files\LibreOffice\program\soffice.exe
# AZURE_OFFICE_LIBREOFFICE_PATH=/usr/bin/soffice

# Media Description
# Options: disabled, gpt4o
# PRODUCTION RECOMMENDATION: disabled (unless needed, to reduce costs)
AZURE_MEDIA_DESCRIBER=disabled

# If enabled:
# AZURE_MEDIA_DESCRIBER=gpt4o
# AZURE_MEDIA_MAX_CONCURRENCY=5

# Table Rendering
AZURE_TABLE_RENDER=markdown

# Table Summaries (uses extra API calls)
# PRODUCTION RECOMMENDATION: false (unless needed)
AZURE_TABLE_SUMMARIES=false

# ==========================================
# CHUNKING CONFIGURATION
# ==========================================

# Chunking Parameters
# Adjust based on your use case and embedding model
CHUNKING_MAX_CHARS=2000
CHUNKING_MAX_TOKENS=500
CHUNKING_OVERLAP_PERCENT=10

# Cross-page overlap (preserve context across pages)
CHUNKING_CROSS_PAGE_OVERLAP=true

# ==========================================
# PERFORMANCE CONFIGURATION (Production-Optimized)
# ==========================================

# Parallel Processing
# Adjust based on your Azure service tiers and rate limits
AZURE_CHUNKING_MAX_WORKERS=8

# Concurrency Limits
AZURE_CHUNKING_MAX_IMAGE_CONCURRENCY=12
AZURE_CHUNKING_MAX_BATCH_UPLOAD_CONCURRENCY=10

# Embedding Batch Size
AZURE_EMBED_BATCH_SIZE=256

# Upload Batch Size
AZURE_UPLOAD_BATCH_SIZE=1000

# ==========================================
# LOGGING CONFIGURATION
# ==========================================

# Log Level
# PRODUCTION: INFO (detailed but not excessive)
LOG_LEVEL=INFO

# File logging level
# PRODUCTION: INFO or DEBUG for troubleshooting
LOG_FILE_LEVEL=INFO

# Artifact logging
LOG_ARTIFACTS=true

# Color output (set false for log aggregation systems)
LOG_USE_COLORS=false

# ==========================================
# MONITORING AND OBSERVABILITY
# ==========================================

# Enable detailed metrics
ENABLE_METRICS=true

# Metrics export (if using monitoring system)
# METRICS_ENDPOINT=https://your-monitoring-endpoint
# METRICS_API_KEY=your-metrics-api-key

# Application Insights (Azure monitoring)
# APPINSIGHTS_INSTRUMENTATION_KEY=your-appinsights-key
# APPINSIGHTS_CONNECTION_STRING=InstrumentationKey=your-key;IngestionEndpoint=...

# ==========================================
# PRODUCTION BEST PRACTICES
# ==========================================

# 1. SECURITY
#    - Store secrets in Azure Key Vault, not in .env
#    - Use managed identities when running in Azure
#    - Use service principals with least-privilege access
#    - Rotate credentials regularly
#    - Enable Azure AD authentication

# 2. RELIABILITY
#    - Use INPUT_MODE=blob for scalability
#    - Use ARTIFACTS_MODE=blob for persistence
#    - Enable AZURE_OFFICE_OFFLINE_FALLBACK=true
#    - Implement retry logic (see 03_error_handling_recovery.py)
#    - Monitor API rate limits and quotas

# 3. PERFORMANCE
#    - Tune concurrency based on service tier
#    - Monitor and optimize chunk sizes
#    - Use batch processing during off-peak hours
#    - Cache embedding models
#    - Consider reserved capacity for predictable workloads

# 4. COST OPTIMIZATION
#    - Set AZURE_MEDIA_DESCRIBER=disabled if not needed
#    - Set AZURE_TABLE_SUMMARIES=false if not needed
#    - Monitor token usage
#    - Consider hybrid mode (AZURE_OFFICE_EXTRACTOR_MODE=hybrid)
#    - Set up cost alerts and budgets
#    - Review and optimize chunking parameters

# 5. MONITORING
#    - Enable Application Insights
#    - Set up alerts for failures
#    - Monitor processing metrics
#    - Track API usage and costs
#    - Implement health checks

# 6. DISASTER RECOVERY
#    - Backup processed documents
#    - Document recovery procedures
#    - Test failover scenarios
#    - Maintain processing checkpoints
#    - Keep audit logs

# ==========================================
# PRODUCTION DEPLOYMENT STEPS
# ==========================================

# 1. INFRASTRUCTURE SETUP
#    ☐ Create Azure Search service
#    ☐ Create Azure OpenAI deployment
#    ☐ Create Document Intelligence resource
#    ☐ Create Storage Account
#    ☐ Create containers: production-documents-input, production-artifacts
#    ☐ Create search index (run with --setup-index)

# 2. SECURITY CONFIGURATION
#    ☐ Create service principal
#    ☐ Set up Key Vault
#    ☐ Store secrets in Key Vault
#    ☐ Configure managed identity (if running in Azure)
#    ☐ Set up RBAC permissions
#    ☐ Enable audit logging

# 3. MONITORING SETUP
#    ☐ Enable Application Insights
#    ☐ Configure alerts for failures
#    ☐ Set up cost alerts
#    ☐ Configure log aggregation
#    ☐ Set up dashboards

# 4. TESTING
#    ☐ Test with small document set
#    ☐ Validate all Azure connections
#    ☐ Test error scenarios
#    ☐ Verify monitoring and alerts
#    ☐ Load test if needed

# 5. DEPLOYMENT
#    ☐ Deploy to production environment
#    ☐ Configure production .env
#    ☐ Run initial processing
#    ☐ Monitor metrics
#    ☐ Validate results

# 6. ONGOING OPERATIONS
#    ☐ Monitor daily metrics
#    ☐ Review error reports
#    ☐ Optimize based on usage patterns
#    ☐ Update documentation
#    ☐ Plan for scaling

# ==========================================
# COST ESTIMATES (Azure - Approximate)
# ==========================================
# Based on moderate usage (100 PDFs/day, avg 10 pages each)
#
# Azure Document Intelligence:
#   ~$0.01 per page × 1,000 pages = $10/day = ~$300/month
#
# Azure OpenAI Embeddings:
#   ~$0.0001 per 1K tokens × 500K tokens = $50/month
#
# Azure AI Search:
#   Basic tier: $75/month
#   Standard S1: $250/month
#
# Azure Storage:
#   ~$0.02 per GB × 50GB = $1/month (negligible)
#
# TOTAL: ~$400-600/month for moderate usage
#
# NOTE: Actual costs vary based on:
# - Document volume and size
# - Processing complexity
# - Service tiers selected
# - Data retention policies

# ==========================================
# TROUBLESHOOTING
# ==========================================

# Production deployment issues:
#
# 1. "Container not found"
#    - Create input container in Azure Portal or CLI
#    - Verify container name matches AZURE_BLOB_CONTAINER_IN
#
# 2. "Authentication failed"
#    - Verify service principal has correct permissions
#    - Check Key Vault access policies
#    - Ensure connection strings are correct
#
# 3. "Rate limit exceeded"
#    - Reduce concurrency settings
#    - Implement exponential backoff
#    - Upgrade service tier if needed
#
# 4. "High costs"
#    - Review AZURE_MEDIA_DESCRIBER setting
#    - Check AZURE_TABLE_SUMMARIES setting
#    - Optimize chunking to reduce token count
#    - Consider hybrid embeddings mode
#
# 5. "Processing too slow"
#    - Increase AZURE_CHUNKING_MAX_WORKERS
#    - Increase concurrency settings
#    - Upgrade service tiers
#    - Consider parallel processing

# ==========================================
# SUPPORT
# ==========================================
# For production support:
# - Review logs in ./production_*.log
# - Check metrics in production_metrics_*.json
# - Review error reports in error_report_*.json
# - Contact Azure support for service issues
# - Review documentation at docs.microsoft.com
