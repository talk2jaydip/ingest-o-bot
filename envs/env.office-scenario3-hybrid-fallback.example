# ==========================================
# OFFICE SCENARIO 3: Hybrid Mode with Fallback (RECOMMENDED)
# ==========================================
# Use when: Maximum reliability, graceful degradation, production
# Requirements: Azure DI configured, LibreOffice optional for DOC files
# Benefits: Best quality when available, automatic fallback on failure
# Best for: Production environments requiring maximum uptime
# ==========================================

# ==========================================
# Azure Service Principal Credentials
# ==========================================
AZURE_TENANT_ID=your-tenant-id-here
AZURE_CLIENT_ID=your-client-id-here
AZURE_CLIENT_SECRET=your-client-secret-here

# ==========================================
# Key Vault Configuration (Optional)
# ==========================================
KEY_VAULT_URI=https://your-keyvault.vault.azure.net/

# ==========================================
# Document Intelligence
# ==========================================
AZURE_DOC_INT_ENDPOINT=https://your-di.cognitiveservices.azure.com/
AZURE_DOC_INT_KEY=your-di-key-here
AZURE_DI_MAX_CONCURRENCY=5

# ==========================================
# Azure AI Search
# ==========================================
AZURE_SEARCH_SERVICE=your-search-service
AZURE_SEARCH_KEY=your-search-key-here
AZURE_SEARCH_INDEX=your-index

# ==========================================
# Azure OpenAI
# ==========================================
AZURE_OPENAI_ENDPOINT=https://your-openai.openai.azure.com/
AZURE_OPENAI_KEY=your-openai-key-here
AZURE_OPENAI_API_KEY=your-openai-key-here
AZURE_OPENAI_API_VERSION=2024-12-01-preview
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-large
AZURE_OPENAI_EMBEDDING_MODEL=text-embedding-3-large
AZURE_OPENAI_EMBEDDING_NAME=text-embedding-3-large
AZURE_OPENAI_EMBEDDING_DIMENSIONS=1536
AZURE_OPENAI_CHAT_DEPLOYMENT=gpt-4o
AZURE_OPENAI_MODEL_NAME=gpt-4o
AZURE_OPENAI_MODEL=gpt-4o

# Concurrency and retries
AZURE_OPENAI_MAX_CONCURRENCY=10
AZURE_OPENAI_MAX_RETRIES=3

# ==========================================
# Azure Storage Account
# ==========================================
AZURE_STORAGE_ACCOUNT=your-storage-account
AZURE_STORAGE_ACCOUNT_KEY=your-storage-key-here
AZURE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=your-storage-account;AccountKey=your-storage-key-here;EndpointSuffix=core.windows.net

# ==========================================
# Input Configuration
# ==========================================
AZURE_INPUT_MODE=local
AZURE_LOCAL_GLOB=documents/**/*.{doc,docx,pptx,pdf}
AZURE_ARTIFACTS_DIR=./artifacts

# ==========================================
# Document Action Mode
# ==========================================
AZURE_DOCUMENT_ACTION=add

# ==========================================
# Document Intelligence Extraction
# ==========================================
EXTRACTION_METHOD=layout_then_ocr
DI_BATCH_SIZE=16
DI_MAX_RETRIES=3

# ==========================================
# PDF Processing
# ==========================================
SPLIT_PDF_BY_PAGE=true

# ==========================================
# Chunking Configuration
# ==========================================
CHUNKER_TARGET_TOKEN_COUNT=8100
CHUNKER_OVERLAP_TOKEN_COUNT=100
CHUNKER_DISABLE_CHAR_LIMIT=true
CHUNKER_CROSS_PAGE_OVERLAP=true

# ==========================================
# Table Processing
# ==========================================
TABLE_RENDER_MODE=markdown
TABLE_SUMMARIES=false

# ==========================================
# Figure/Image Processing
# ==========================================
MEDIA_DESCRIBER_MODE=gpt4o

# ==========================================
# Processing Options
# ==========================================
AZURE_USE_INTEGRATED_VECTORIZATION=true

# ==========================================
# Performance Tuning
# ==========================================
AZURE_MAX_WORKERS=4
AZURE_INNER_ANALYZE_WORKERS=1
AZURE_UPLOAD_DELAY=0.2
AZURE_EMBED_BATCH_SIZE=128
AZURE_UPLOAD_BATCH_SIZE=500

# ==========================================
# OFFICE SCENARIO 3: Hybrid Mode with Fallback (RECOMMENDED)
# ==========================================
AZURE_OFFICE_EXTRACTOR_MODE=hybrid

# Enable automatic fallback to MarkItDown if Azure DI fails
AZURE_OFFICE_OFFLINE_FALLBACK=true

# File size limit for Office documents
AZURE_OFFICE_MAX_FILE_SIZE_MB=100

# Enable LaTeX equation extraction when using Azure DI
AZURE_OFFICE_EQUATION_EXTRACTION=true

# Verbose logging
AZURE_OFFICE_VERBOSE=true

# ==========================================
# LIBREOFFICE CONFIGURATION (OPTIONAL)
# ==========================================
# LibreOffice is OPTIONAL in hybrid mode:
# - DOCX/PPTX: Will try Azure DI first, fallback to MarkItDown if needed
# - DOC: Always uses MarkItDown (Azure DI doesn't support DOC)
# - If LibreOffice not installed: DOC files will fail

# Linux/Mac:
AZURE_OFFICE_LIBREOFFICE_PATH=/usr/bin/soffice

# Windows (uncomment and use this instead):
# AZURE_OFFICE_LIBREOFFICE_PATH=C:\\Program Files\\LibreOffice\\program\\soffice.exe

# If you don't have DOC files, you can comment out or remove LibreOffice path
# (DOCX/PPTX will still work via Azure DI ‚Üí MarkItDown fallback)

# ==========================================
# HOW HYBRID MODE WORKS:
# ==========================================

# For DOCX files:
# 1. Try Azure DI first (highest quality)
# 2. If Azure DI fails ‚Üí Fallback to MarkItDown
# 3. If MarkItDown fails ‚Üí Error

# For PPTX files:
# 1. Try Azure DI first (highest quality)
# 2. If Azure DI fails ‚Üí Fallback to MarkItDown
# 3. If MarkItDown fails ‚Üí Error

# For DOC files (legacy):
# 1. Skip Azure DI (not supported)
# 2. Use MarkItDown directly (requires LibreOffice)
# 3. If MarkItDown fails ‚Üí Error

# For PDF files:
# 1. Use Azure DI (configured separately via EXTRACTION_METHOD)

# ==========================================
# FEATURE AVAILABILITY:
# ==========================================

# When Azure DI succeeds (DOCX/PPTX):
# ‚úÖ Text Extraction: Excellent quality
# ‚úÖ Tables: Full structure with cells
# ‚úÖ Bounding Boxes: Available
# ‚úÖ LaTeX Equations: Available (premium tier)
# ‚úÖ Figure Extraction: High quality
# üí∞ Cost: Azure DI fees apply

# When fallback to MarkItDown (DOCX/PPTX):
# ‚úÖ Text Extraction: Good quality (70-80% of DI)
# ‚úÖ Tables: Markdown format only
# ‚ùå Bounding Boxes: NOT available
# ‚ùå LaTeX Equations: NOT available
# ‚úÖ Figure Extraction: Basic
# üí∞ Cost: FREE (no Azure fees)

# For DOC files (always MarkItDown):
# ‚úÖ Text Extraction: Good quality via LibreOffice
# ‚úÖ Tables: Markdown format only
# ‚ùå Bounding Boxes: NOT available
# ‚ùå LaTeX Equations: NOT available
# üí∞ Cost: FREE (requires LibreOffice)

# ==========================================
# RELIABILITY & GRACEFUL DEGRADATION:
# ==========================================

# Hybrid mode provides maximum reliability:
# ‚úÖ Azure DI outage ‚Üí Automatic fallback to MarkItDown
# ‚úÖ Azure DI quota exceeded ‚Üí Fallback to MarkItDown
# ‚úÖ Azure DI timeout ‚Üí Fallback to MarkItDown
# ‚úÖ Network issues ‚Üí Fallback to MarkItDown
# ‚úÖ Unsupported features ‚Üí Best available method

# This ensures your pipeline continues running even if:
# - Azure services are temporarily unavailable
# - You hit quota limits
# - Network connectivity is unstable
# - You have mixed document types (DOCX + DOC)

# ==========================================
# WHEN TO USE THIS SCENARIO (RECOMMENDED):
# ==========================================
# ‚úÖ Production environments requiring maximum uptime
# ‚úÖ Mixed document types (DOCX, PPTX, DOC)
# ‚úÖ Want best quality but need reliability
# ‚úÖ Unpredictable Azure service availability
# ‚úÖ Processing large volumes (quota concerns)
# ‚úÖ Need graceful degradation
# ‚úÖ Want to support legacy DOC files
# ‚ùå DON'T use if you require guaranteed bounding boxes
# ‚ùå DON'T use if every document MUST have LaTeX equations

# ==========================================
# COMPARISON WITH OTHER SCENARIOS:
# ==========================================

# vs Scenario 1 (Azure DI Only):
# ‚úÖ More reliable (has fallback)
# ‚úÖ Supports DOC files
# ‚úÖ Handles Azure outages gracefully
# ‚ùå Slightly more complex configuration

# vs Scenario 2 (MarkItDown Only):
# ‚úÖ Much better quality when Azure DI works
# ‚úÖ LaTeX equations available
# ‚úÖ Bounding boxes available
# ‚ùå Requires Azure credentials
# ‚ùå Costs more (Azure DI fees)

# ==========================================
# BEST PRACTICES:
# ==========================================

# 1. Install LibreOffice for DOC file support
# 2. Enable AZURE_OFFICE_VERBOSE=true for debugging
# 3. Monitor which files use fallback via logs
# 4. Set appropriate timeout values for Azure DI
# 5. Test with both Azure DI and fallback scenarios
# 6. Keep MarkItDown updated for best offline quality

# ==========================================
# MONITORING FALLBACK USAGE:
# ==========================================

# Check logs to see which files used fallback:
# grep "Falling back to MarkItDown" logs/pipeline.log

# If too many files use fallback:
# - Check Azure DI service health
# - Verify quota limits
# - Check network connectivity
# - Review file sizes (may exceed limits)

# ==========================================
# INSTALLATION INSTRUCTIONS:
# ==========================================

# For DOC file support, install LibreOffice:

# Linux (Debian/Ubuntu):
# sudo apt-get update && sudo apt-get install libreoffice

# Mac:
# brew install --cask libreoffice

# Windows:
# Download from: https://www.libreoffice.org/download/

# Verify:
# soffice --version

# ==========================================
# TO USE THIS FILE:
# ==========================================
# 1. Install LibreOffice (optional, only needed for DOC files)
# 2. Copy: cp envs/env.office-scenario3-hybrid-fallback.example .env
# 3. Edit .env with your real Azure credentials
# 4. Update LibreOffice path if needed (or remove if no DOC files)
# 5. Run: prepdocs --setup-index --glob "documents/**/*.{doc,docx,pptx}"
#
# This is the RECOMMENDED configuration for production!
# ==========================================
